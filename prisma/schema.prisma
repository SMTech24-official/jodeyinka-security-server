// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                            String          @id @default(auto()) @map("_id") @db.ObjectId
  firstName                     String?
  lastName                      String?
  userName                      String?
  userFullName                  String?
  organizationName              String?
  email                         String          @unique
  country                       String?
  state                         String?
  address                       String?
  avatarUrl                     String?
  password                      String?
  twoFactor                     Boolean         @default(false)
  twoFactorOTP                  String?
  twoFactorOTPExpires           DateTime?
  emailVerificationToken        String?
  emailVerificationTokenExpires DateTime?
  forgotPasswordOTP             String?
  forgotPasswordOTPExpires      DateTime?
  dob                           DateTime?
  number                        String?
  isEmailVerified               Boolean         @default(false)
  sponsorStatus                 SponsorStatus   @default(NONE)
  role                          UserRoleEnum    @default(USER)
  status                        UserStatus      @default(ACTIVE)
  createdAt                     DateTime        @default(now())
  updatedAt                     DateTime        @updatedAt
  Resources                     Resource[]
  Comment                       Comment[]
  Event                         Event[]
  Notifications                 Notifications[]
  Transaction                   Transaction[]
  EventSponsor                  EventSponsor[]
  EventsUser                    EventsUser[]

  @@map("users")
}

model Resource {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  authorId    String       @db.ObjectId
  Author      User         @relation(fields: [authorId], references: [id])
  fileUrl     String?
  description String
  type        ResourceType
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  Comments    Comment[]

  @@map("resources")
}

model Comment {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  resourceId String   @db.ObjectId
  Resource   Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)
  authorId   String   @db.ObjectId
  Author     User     @relation(fields: [authorId], references: [id])
  content    String
  createdAt  DateTime @default(now())

  @@map("comments")
}

model EventSponsor {
  id        String           @id @default(auto()) @map("_id") @db.ObjectId
  tier      EventSponsorTier
  fee       Float
  eventId   String           @db.ObjectId
  event     Event            @relation(fields: [eventId], references: [id])
  sponsorId String           @db.ObjectId
  sponsor   User             @relation(fields: [sponsorId], references: [id])

  @@map("event_sponsors")
}

model Event {
  id                       String         @id @default(auto()) @map("_id") @db.ObjectId
  hostId                   String         @db.ObjectId
  host                     User           @relation(fields: [hostId], references: [id])
  type                     String?
  title                    String
  imageUrl                 String?
  description              String
  date                     DateTime
  latitude                 Float
  longitude                Float
  silverSponsorFee         Float
  goldSponsorFee           Float
  platinumSponsorFee       Float
  silverSponsorAvailable   Boolean        @default(true)
  goldSponsorAvailable     Boolean        @default(true)
  platinumSponsorAvailable Boolean        @default(true)
  endTime                  DateTime?
  venue                    String
  createdAt                DateTime       @default(now())
  EventSponsor             EventSponsor[]
  EventsUser               EventsUser[]

  @@map("events")
}

model EventsUser {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  eventId String @db.ObjectId
  event   Event  @relation(fields: [eventId], references: [id])
  userId  String @db.ObjectId
  user    User   @relation(fields: [userId], references: [id])

  @@unique([eventId, userId])
  @@map("events_user")
}

model Notifications {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  receiverId  String?  @db.ObjectId
  receiver    User?    @relation(fields: [receiverId], references: [id])
  title       String
  description String
  createdAt   DateTime @default(now())

  @@map("notifications")
}

model Transaction {
  id        String              @id @default(auto()) @map("_id") @db.ObjectId
  userId    String              @db.ObjectId
  user      User                @relation(fields: [userId], references: [id])
  paymentId String
  amount    Float
  type      TransactionTypeEnum
  currency  String
  method    String
  createdAt DateTime            @default(now())

  @@map("transactions")
}

enum UserRoleEnum {
  USER
  SPONSOR
  MEMBER
  ADMIN
  SUPERADMIN
}

enum TransactionTypeEnum {
  MEMBERSHIP
  SPONSORSHIP
  DONATION
}

enum SponsorStatus {
  PENDING
  APPROVED
  NONE
}

enum EventSponsorTier {
  SILVER
  GOLD
  PLATINUM
}

enum UserStatus {
  ACTIVE
  PENDING
  INACTIVATE
  BLOCKED
}

enum ResourceType {
  MEDIA
  RESOURCE
  BLOG
}
